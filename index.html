
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suivi de Dossiers</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #2196f3; color: white; }
    tr:nth-child(even) { background: #f9f9f9; }
    input, select, textarea { padding: 5px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    .form { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; background: white; padding: 15px; border-radius: 8px; }
    .form > div { display: flex; flex-direction: column; }
    .actions { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px; }
    button { padding: 8px 12px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
    .add { background: #03a9f4; color: white; }
    .update { background: #4caf50; color: white; }
    .edit { background: #2196f3; color: white; }
    .delete { background: #f44336; color: white; }
    #notif { color: green; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Suivi de Dossiers</h1>

  <div class="form">
    <div><label>Client</label><input id="client" type="text" /></div>
    <div><label>Dossier</label><input id="dossier" type="text" /></div>
    <div><label>Num√©ro MPR</label><input id="mpr" type="text" /></div>
    <div><label>Statut</label><select id="statut"></select></div>
    <div><label>T√©l√©phone</label><input id="tel" type="text" /></div>
    <div><label>Mail</label><input id="mail" type="email" /></div>
    <div><label>Adresse</label><input id="adresse" type="text" /></div>
    <div><label>Date de rappel</label><input id="rappel" type="date" /></div>
    <div><label>Mat√©riel install√©</label><input id="materiel" type="text" /></div>
    <div><label>Document</label><input id="doc" type="file" /></div>
    <div style="grid-column: span 3;"><label>Commentaire</label><textarea id="commentaire" rows="3"></textarea></div>
  </div>

  <div class="actions">
    <button id="btnAjouter" class="add" onclick="ajouterDossier()">‚ûï Ajouter</button>
    <input type="text" id="rechercheMPR" placeholder="üîé Rechercher par MPR..." oninput="afficherDossiers()" />
  </div>

  <div id="notif"></div>

  <table>
    <thead>
      <tr>
        <th>Client</th><th>Dossier</th><th>MPR</th><th>Statut</th><th>T√©l√©phone</th><th>Mail</th><th>Adresse</th>
        <th>Date rappel</th><th>Mat√©riel</th><th>Document</th><th>Commentaire</th><th>Actions</th>
      </tr>
    </thead>
    <tbody id="tableau"></tbody>
  </table>

  <script>
    const statuts = ["Anomalie recommand√©e", "Demande de subvention", "Subvention non d√©posable", "En attente octroi", "Octroi accept√©", "Octroi rejet√©"];
    let dossiers = JSON.parse(localStorage.getItem("dossiers") || "[]");
    let indexModif = null;

    const selectStatut = document.getElementById("statut");
    statuts.forEach(s => {
      const opt = document.createElement("option");
      opt.textContent = s;
      selectStatut.appendChild(opt);
    });

    function afficherNotif(message) {
      const notif = document.getElementById("notif");
      notif.textContent = message;
      setTimeout(() => notif.textContent = "", 3000);
    }

    function ajouterDossier() {
      const client = document.getElementById("client").value.trim();
      const dossier = document.getElementById("dossier").value.trim();
      const mpr = document.getElementById("mpr").value.trim();
      const statut = document.getElementById("statut").value;
      const tel = document.getElementById("tel").value.trim();
      const mail = document.getElementById("mail").value.trim();
      const adresse = document.getElementById("adresse").value.trim();
      const rappel = document.getElementById("rappel").value;
      const materiel = document.getElementById("materiel").value.trim();
      const doc = document.getElementById("doc").files[0]?.name || "";
      const commentaire = document.getElementById("commentaire").value.trim();

      if (!client || !dossier) return alert("Client et Dossier sont obligatoires.");

      const newDossier = { client, dossier, mpr, statut, tel, mail, adresse, rappel, materiel, doc, commentaire };

      if (indexModif !== null) {
        dossiers[indexModif] = newDossier;
        indexModif = null;
        document.getElementById("btnAjouter").textContent = "‚ûï Ajouter";
        document.getElementById("btnAjouter").className = "add";
        afficherNotif("‚úÖ Dossier mis √† jour !");
      } else {
        dossiers.push(newDossier);
        afficherNotif("‚úÖ Dossier ajout√© !");
      }

      localStorage.setItem("dossiers", JSON.stringify(dossiers));
      document.querySelectorAll("input, textarea").forEach(e => e.value = "");
      afficherDossiers();
    }

    function modifierDossier(i) {
      const d = dossiers[i];
      Object.entries(d).forEach(([key, val]) => {
        if (document.getElementById(key)) document.getElementById(key).value = val;
      });
      indexModif = i;
      document.getElementById("btnAjouter").textContent = "‚úÖ Mettre √† jour";
      document.getElementById("btnAjouter").className = "update";
    }

    function supprimerDossier(i) {
      if (confirm("Voulez-vous vraiment supprimer ce dossier ?")) {
        dossiers.splice(i, 1);
        localStorage.setItem("dossiers", JSON.stringify(dossiers));
        afficherDossiers();
        afficherNotif("üóëÔ∏è Dossier supprim√©.");
      }
    }

    function afficherDossiers() {
      const tableau = document.getElementById("tableau");
      tableau.innerHTML = "";
      const filtre = document.getElementById("rechercheMPR").value.trim();

      dossiers
        .filter(d => !filtre || d.mpr.includes(filtre))
        .forEach((d, i) => {
          const row = document.createElement("tr");
          Object.keys(d).forEach(k => {
            const td = document.createElement("td");
            td.contentEditable = true;
            td.textContent = d[k];
            td.addEventListener("blur", () => {
              dossiers[i][k] = td.textContent.trim();
              localStorage.setItem("dossiers", JSON.stringify(dossiers));
            });
            row.appendChild(td);
          });
          const actions = document.createElement("td");
          actions.innerHTML = \`
            <button class="edit" onclick="modifierDossier(\${i})">üñäÔ∏è</button>
            <button class="delete" onclick="supprimerDossier(\${i})">üóëÔ∏è</button>
          \`;
          row.appendChild(actions);
          tableau.appendChild(row);
        });
    }

    afficherDossiers();
  </script>
</body>
</html>
